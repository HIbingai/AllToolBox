name: Main-CI
on:
    push:
        branches:
        - main
    pull_request:
        branches:
        - main
        types: [opened, synchronize, reopened, edited, ready_for_review]
jobs:
    build:
        runs-on: windows-latest
        steps:
        - uses: actions/checkout@v3
        - name: Set up Python
          uses: actions/setup-python@v4
          with:
              python-version: '3.14'
        #install chocolatey
        - name: Install Chocolatey
          run: |
                Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
        # Install MinGW
        - name: Install MinGW
          run: |
                choco install mingw -y
                refreshenv
        - name: Install dependencies
          run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
        - name: Build Project
          run: |
                cmd.exe /c "ezbuild.bat"
        - name: Run Tests
          run: |
                python test.py
        - name: Clean up
          run: |
                cmd.exe /c "clean.bat"

                